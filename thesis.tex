\documentclass[11pt]{report}

\usepackage{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{siunitx}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[all]{hypcap} % ref link aligned to float top (KEEP AFTER HYPERREF!)
\usepackage[font={sf,small}]{caption} % smaller sans font in captions
\usepackage{fancyhdr} % header/footer customization
\usepackage[style=alphabetic]{biblatex} % citations with style [Xyz12]
\usepackage{booktabs} % \*rule commands for tabular
\usepackage{lineno} % \linenumbers

\newlength\bindingoffset
\setlength\bindingoffset{1cm}
\geometry{%
    a4paper,
    asymmetric, % twoside, but marginpar are always to the right
    centering,
    textwidth=360pt, % default LaTeX textwidth with 11pt (345pt for 10pt)
    top=1.8cm,
    bottom=1.8cm,
    marginparwidth=3.4cm,
    headsep=10pt,
    footskip=17pt,
    bindingoffset=\bindingoffset,
    % showframe,
}
\addtolength\marginparwidth{-0.5\bindingoffset}

\linenumbers % print line numbers (for the draft)

\addbibresource{thesis.bib}

\graphicspath{{figures/}}

\sisetup{%
    detect-all, % for units, use the font of the text where they appear
    table-number-alignment=center, % the S columns of tabular are center-aligned
}

% small sans font for marginpar
\let\oldmarginpar\marginpar
\renewcommand\marginpar[1]{\oldmarginpar{\sffamily\tiny #1}}

% commands for supervisors' comments
\newcommand\stracka[1]{\marginpar{\itshape #1}}
\newcommand\paoloni[1]{\marginpar{\ttfamily #1}}

% url prefix for file preview
\newcommand\repofileurl{https://github.com/Gattocrucco/sipmfilter/blob/master}

% scriptlink command. usage: \scriptlink{filename}
\newcommand\scriptlink[1]{\texttt{(\href{\repofileurl/figthesis/#1}{#1})}}

% scriptcaption command
% usage: \scriptcaption{label prefix}{script prefix}{label}{caption}
% the command will define the label and append a link to the python script
% on github
\newcommand\scriptcaption[4]{
    \caption{
        \label{#1:#3} #4
        \scriptlink{#2#3.py}
    }
}
\newcommand\figcaption[2]{\scriptcaption{fig}{fig}{#1}{#2}}
\newcommand\tabcaption[2]{\scriptcaption{tab}{fig}{#1}{#2}}

% widecenter command
% center the contents even if they are larger than the text width
\newcommand\widecenter[1]{\noindent\hspace{-\textwidth}\makebox[3\textwidth][c]{#1}}

% includempl command
% command to include a pdf generated by matplotlib, 0.78125 = 360pt / 6.4in
\newcommand\includempl[1]{\includegraphics[scale=0.78125]{#1}}

\newlength\pagenumbermargin
\setlength\pagenumbermargin{2.9cm}
\addtolength\pagenumbermargin{-0.5\bindingoffset}

\newcommand\hdrside{RO,LE}
\newcommand\sharedstyle{%
    \renewcommand\headrulewidth{0pt}
    \fancyhf{}
    \fancyhfoffset\pagenumbermargin
    \fancyfoot[\hdrside]\thepage
}

\fancypagestyle{plain}\sharedstyle
\pagestyle{fancy}
\sharedstyle
\newcommand\chapterhdr[1]{\clearpage\fancyhead[\hdrside]{\uppercase{#1}}}

\begin{document}
    
    \include{title}
    
    \chapterhdr{contents}
    \tableofcontents
    
    \chapterhdr{introduction}
    \include{intro}
    
    \chapterhdr{chapter~\thechapter}
    \include{darkmat}
    \include{darkside}
    \include{data}
    \include{snr}
    \include{timeres}
    \include{rate}
    \include{anal}
    \include{end}
    
    \chapterhdr{appendix~\thechapter}
    \appendix
    \include{analplot}
    \include{fit}
    
    \chapterhdr{bibliography}
    \printbibliography
    
\end{document}
